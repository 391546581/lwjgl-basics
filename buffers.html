<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>OpenGL Game Engine Pt 2: Buffers</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	
  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="http://mattdesl.github.com/lwjgl-basics/">Home</a></li>
          <li class="downloads"><a href="https://github.com/mattdesl/lwjgl-basics/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/mattdesl/lwjgl-basics/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>lwjgl-basics</h1>
          <p>Writing a Mini Game Library in LWJGL</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/mattdesl">mattdesl</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
        </div>

<!--
	<script type="text/javascript" src="javascripts/shCore.js"></script>
	<script type="text/javascript" src="javascripts/shBrushJava.js"></script>
	 
	<!-- Include *at least* the core style and default theme -->
	<link href="stylesheets/shCore.css" rel="stylesheet" type="text/css" />
	<link href="stylesheets/shThemeDefault.css" rel="stylesheet" type="text/css" />
-->

<h1>Java NIO Buffers</h1>
<p>This is a short introduction to Java NIO buffers, which are commonly used in LWJGL to handle GL data. For a more detailed look at buffers, <a href="http://tutorials.jenkov.com/java-nio/buffers.html" target="_blank">see here</a>.</p>


<h3>Intro</h3>
<p>A buffer is simply a block of memory which holds some data. For our purposes, you can think of it as an array of elements. However, instead of random access (e.g. <tt>array[i]</tt>), Buffers read and write data relative to their current position. To demonstrate, let's say we wish to create a buffer which holds four bytes, and then read those bytes out. You would create it like so:</p>
<pre><code>//LWJGL includes utilities for easily creating buffers
ByteBuffer buffer = BufferUtils.createByteBuffer(4);

//"relative put" method, which places the byte and then moves the position forward
buffer.put(a);
buffer.put(b);
buffer.put(c);
buffer.put(d);

//flip the position to reset the relative position to zero
buffer.flip();

//loop through all of the bytes that were written, using "relative get"
for (int i=0; i&lt;buffer.limit(); i++) {
    System.out.println( buffer.get() );
}
</code></pre>

<p>This is theoretically very similar to the following Java array:</p>
<pre><code>byte[] array = new byte[4];

//position starts at 0
int position = 0;

//using a relative "put", position inreases each time
array[position++] = a;
array[position++] = b;
array[position++] = c;
array[position++] = d;

//"flipping" our position/limit
int limit = position;
position = 0;

//printing our values
for (int i=0; i&lt;limit; i++) {
    //using a relative "get", position inreases each time
    System.out.println( array[position++] );
}
</code></pre>

<p>The "capacity" of a buffer is similar to the length of an array; but as we can see from the above example, the "limit" of a buffer may not be equal to its capacity if we've only written a limited number of bytes. </p>

<p>For convenience, you can "chain" calls with get/put/etc. like so:</p>
<pre><code>buffer.put(a).put(b).put(c).put(d);</code></pre>

<h3>Practical Usage</h3>
<p>So how does this relate to LWJGL and OpenGL? There are two common ways you'll be using buffers: writing data to GL (i.e. uploading texture data to the GPU), or reading data from GL (i.e. reading texture data from the GPU, or getting a certain value from the driver).</p>

<p>Let's say we are creating a 1x1 blue RGBA texture, our buffer setup would look like this:</p>
<pre><code>int width = 1; //1 pixel wide
int height = 1; //1 pixel high
int bpp = 4; //4 bytes per pixel (RGBA)

//create our buffer
ByteBuffer buffer = BufferUtils.createByteBuffer(width * height * bpp);

//put the Red, Green, Blue, and Alpha bytes
buffer.put(0x00).put(0x00).put(0xFF).put(0xFF);

//flip the buffer !!! this needs to be done before it can be read by GL
buffer.flip();

//here is an example of sending data to GL... we will talk more about this method in the Texture section
glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, width, height, 0, GL_RGBA, GL_UNSIGNED_BYTE, buffer);
</code></pre>

<p>Below is an example of getting data from GL:</p>

<pre class="brush: java">
IntBuffer buffer = BufferUtils.createIntBuffer(1);

//this will call the relative "put" on our buffer
glGetInteger(GL_MAX_TEXURE_SIZE, buffer);

//before we read back the values, we need to "flip" it
buffer.flip();

//now we can get the max size as a Java int
int maxSize = buffer.get();
</pre>

<p>As described <a href="http://www.khronos.org/opengles/documentation/opengles1_0/html/glGetInteger.html">here</a>, GL_MAX_TEXTURE_SIZE will give us one value. Some other parameters may return more values, and in that case we would have to create our buffer with a larger capacity. Where possible, you should try to re-use buffers in situations such as this.</p>

<p>Also note that LWJGL includes convenience methods for glGetInteger, glGenTextures, and various other calls. So the above code could be reduced to the following:</p>
<pre>
int maxSize = glGetInteger(GL_MAX_TEXTURE_SIZE);
</pre>

    <p>test2</p>

    </div>

<script type="text/javascript">
     SyntaxHighlighter.all()
</script>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>